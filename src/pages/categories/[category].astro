---
import Layout from "../../layouts/Layout.astro";
import fetchProducts from "../../db";
import ProductCard from "../../components/ProductCard.astro";
import { categoryProductsArr, categoryTranslate } from "../../main";
import CategoryCard from "../../components/CategoryCard.astro";

export const prerender = false;

const { category } = Astro.params;
const newCategory = categoryTranslate(category);

let allProducts;

try {
    allProducts = await fetchProducts();
} catch (error) {
    console.error(error.message);
}

const categoryProducts = allProducts?.filter((element) => element.category === newCategory);
---

<Layout title={"KathZM Shop - " + newCategory}>

    <main>

        <section class="w-[var(--page-width)] text-black mx-auto pt-10">

            <CategoryCard category={category} />

			<h2 class="text-3xl font-bold">Productos de {newCategory}</h2>

			<section class="grid grid-cols-4 pt-5 gap-5">
				{
          			categoryProducts.length ?
                      categoryProducts?.map((item) => (
						<a href={"/product/" + item.name}>
							<ProductCard productName={item.name} productImage={"data:image/png;base64," + item.image} productPrice={item.price} available={item.available} ></ProductCard>
						</a>
				  	))
                    :
                    <h2>No hay productos</h2>
				}
			</section>

			<section class="w-100 flex justify-center mt-5">
				<a href="/allProducts" class="bg-black px-4 py-2 text-white rounded shadow">Mostrar todo</a>
			</section>

		</section>

    </main>

</Layout>